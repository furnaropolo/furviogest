{{template "base" .}}

{{define "content"}}
<div class="page-header">
    <h1>{{if .Data}}Modifica Compagnia{{else}}Nuova Compagnia{{end}}</h1>
</div>

<div class="form-container">
    <form method="POST" enctype="multipart/form-data" class="form">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-building me-2"></i>Dati Compagnia</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <div class="form-group mb-3">
                            <label for="nome" class="form-label">Nome Compagnia *</label>
                            <input type="text" class="form-control" id="nome" name="nome" value="{{if .Data}}{{.Data.Nome}}{{end}}" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label for="email_destinatari" class="form-label">Destinatari Email Permessi</label>
                            <select class="form-select" id="email_destinatari" name="email_destinatari">
                                <option value="solo_agenzia" {{if .Data}}{{if eq .Data.EmailDestinatari "solo_agenzia"}}selected{{end}}{{end}}>Solo Agenzia</option>
                                <option value="tutti" {{if .Data}}{{if eq .Data.EmailDestinatari "tutti"}}selected{{end}}{{end}}>Agenzia + Ispettore + Master + DDM</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="bi bi-geo-alt me-2"></i>Sede Legale</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <div class="form-group mb-3">
                            <label for="indirizzo" class="form-label">Indirizzo</label>
                            <input type="text" class="form-control" id="indirizzo" name="indirizzo" value="{{if .Data}}{{.Data.Indirizzo}}{{end}}" placeholder="Via/Piazza e numero civico">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label for="cap" class="form-label">CAP</label>
                            <input type="text" class="form-control" id="cap" name="cap" value="{{if .Data}}{{.Data.CAP}}{{end}}" maxlength="5">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-8">
                        <div class="form-group mb-3">
                            <label for="citta" class="form-label">Citt√†</label>
                            <input type="text" class="form-control" id="citta" name="citta" value="{{if .Data}}{{.Data.Citta}}{{end}}">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group mb-3">
                            <label for="provincia" class="form-label">Provincia</label>
                            <input type="text" class="form-control" id="provincia" name="provincia" value="{{if .Data}}{{.Data.Provincia}}{{end}}" maxlength="2" placeholder="es. MI">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="piva" class="form-label">Partita IVA</label>
                            <input type="text" class="form-control" id="piva" name="piva" value="{{if .Data}}{{.Data.PIVA}}{{end}}" maxlength="11">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="codice_fiscale" class="form-label">Codice Fiscale</label>
                            <input type="text" class="form-control" id="codice_fiscale" name="codice_fiscale" value="{{if .Data}}{{.Data.CodiceFiscale}}{{end}}" maxlength="16">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-telephone me-2"></i>Contatti</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="telefono" class="form-label">Telefono</label>
                            <input type="tel" class="form-control" id="telefono" name="telefono" value="{{if .Data}}{{.Data.Telefono}}{{end}}">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" value="{{if .Data}}{{.Data.Email}}{{end}}">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="bi bi-image me-2"></i>Logo Compagnia</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        {{if .Data}}{{if .Data.Logo}}
                        <div class="mb-3">
                            <label class="form-label">Logo attuale</label>
                            <div class="border p-3 bg-light text-center">
                                <img src="/compagnie/logo/{{.Data.ID}}" alt="Logo {{.Data.Nome}}" style="max-height: 80px; max-width: 200px;">
                            </div>
                        </div>
                        {{end}}{{end}}
                        <div class="form-group mb-3">
                            <label for="logo" class="form-label">{{if .Data}}{{if .Data.Logo}}Sostituisci logo{{else}}Carica logo{{end}}{{else}}Carica logo{{end}}</label>
                            <input type="file" class="form-control" id="logo" name="logo" accept="image/*">
                            <small class="text-muted">Formati supportati: PNG, JPG, GIF. Max 2MB.</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="note" class="form-label">Note</label>
                            <textarea class="form-control" id="note" name="note" rows="4">{{if .Data}}{{.Data.Note}}{{end}}</textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions d-flex gap-2">
            <button type="submit" class="btn btn-primary"><i class="bi bi-check-lg me-1"></i>{{if .Data}}Salva Modifiche{{else}}Crea Compagnia{{end}}</button>
            <a href="/compagnie" class="btn btn-secondary"><i class="bi bi-x-lg me-1"></i>Annulla</a>
        </div>
    </form>
</div>
{{end}}
