{{template "base" .}}

{{define "content"}}
<div class="page-header">
    <h1>Riepilogo Trasferte</h1>
    <div class="page-actions">
        <a href="/amministrazione/trasferte/export?tecnico={{.Data.TecnicoFilter}}&mese={{.Data.MeseFilter}}&anno={{.Data.AnnoFilter}}" class="btn btn-primary">Scarica CSV</a>
        <a href="/amministrazione" class="btn btn-secondary">Torna alla Dashboard</a>
    </div>
</div>

<div class="filter-form">
    <form method="GET" class="form-inline">
        <div class="form-group">
            <label for="tecnico">Tecnico</label>
            <select name="tecnico" id="tecnico">
                <option value="">Tutti</option>
                {{range .Data.Tecnici}}
                <option value="{{.ID}}" {{if eq (printf "%d" .ID) $.Data.TecnicoFilter}}selected{{end}}>
                    {{.Cognome}} {{.Nome}}
                </option>
                {{end}}
            </select>
        </div>
        <div class="form-group">
            <label for="mese">Mese</label>
            <select name="mese" id="mese">
                <option value="">Tutti</option>
                <option value="01" {{if eq .Data.MeseFilter "01"}}selected{{end}}>Gennaio</option>
                <option value="02" {{if eq .Data.MeseFilter "02"}}selected{{end}}>Febbraio</option>
                <option value="03" {{if eq .Data.MeseFilter "03"}}selected{{end}}>Marzo</option>
                <option value="04" {{if eq .Data.MeseFilter "04"}}selected{{end}}>Aprile</option>
                <option value="05" {{if eq .Data.MeseFilter "05"}}selected{{end}}>Maggio</option>
                <option value="06" {{if eq .Data.MeseFilter "06"}}selected{{end}}>Giugno</option>
                <option value="07" {{if eq .Data.MeseFilter "07"}}selected{{end}}>Luglio</option>
                <option value="08" {{if eq .Data.MeseFilter "08"}}selected{{end}}>Agosto</option>
                <option value="09" {{if eq .Data.MeseFilter "09"}}selected{{end}}>Settembre</option>
                <option value="10" {{if eq .Data.MeseFilter "10"}}selected{{end}}>Ottobre</option>
                <option value="11" {{if eq .Data.MeseFilter "11"}}selected{{end}}>Novembre</option>
                <option value="12" {{if eq .Data.MeseFilter "12"}}selected{{end}}>Dicembre</option>
            </select>
        </div>
        <div class="form-group">
            <label for="anno">Anno</label>
            <select name="anno" id="anno">
                <option value="">Tutti</option>
                <option value="2024" {{if eq .Data.AnnoFilter "2024"}}selected{{end}}>2024</option>
                <option value="2025" {{if eq .Data.AnnoFilter "2025"}}selected{{end}}>2025</option>
                <option value="2026" {{if eq .Data.AnnoFilter "2026"}}selected{{end}}>2026</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Filtra</button>
        <a href="/amministrazione/trasferte" class="btn btn-secondary">Reset</a>
    </form>
</div>

<div class="totali-box">
    <div class="totale-item">
        <strong>Totale Km:</strong> {{printf "%.0f" .Data.TotKm}} km
    </div>
    <div class="totale-item">
        <strong>Totale Indennità:</strong> {{printf "%.2f" .Data.TotIndennita}} €
    </div>
</div>

<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>Data Partenza</th>
                <th>Data Rientro</th>
                <th>Tecnico</th>
                <th>Destinazione</th>
                <th>Motivo</th>
                <th>Automezzo</th>
                <th class="text-right">Km</th>
                <th class="text-right">Indennità</th>
                <th>Stato</th>
            </tr>
        </thead>
        <tbody>
            {{range .Data.Trasferte}}
            <tr>
                <td>{{.DataPartenza}}</td>
                <td>{{.DataRientro}}</td>
                <td>{{.Tecnico}}</td>
                <td>{{.Destinazione}}</td>
                <td>{{.Motivo}}</td>
                <td>{{.Automezzo}}</td>
                <td class="text-right">{{printf "%.0f" .KmTotali}}</td>
                <td class="text-right">{{printf "%.2f €" .IndennitaTotale}}</td>
                <td>
                    <span class="badge badge-{{if eq .Stato "completata"}}success{{else if eq .Stato "in_corso"}}warning{{else}}secondary{{end}}">
                        {{.Stato}}
                    </span>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="9" class="text-center">Nessuna trasferta trovata</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<style>
.filter-form {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.form-inline {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: flex-end;
}

.form-inline .form-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.form-inline label {
    font-size: 0.85rem;
    color: #666;
}

.form-inline select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.totali-box {
    display: flex;
    gap: 30px;
    background: #e8f4fd;
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.totale-item {
    font-size: 1.1rem;
}

.badge-success { background-color: #28a745; color: white; }
.badge-warning { background-color: #ffc107; color: #333; }
.badge-secondary { background-color: #6c757d; color: white; }

.text-right { text-align: right; }
.text-center { text-align: center; }
</style>
{{end}}
