{{template "base" .}}

{{define "content"}}
<div class="page-header">
    <h1>{{if .Data.Nave.ID}}Modifica Nave{{else}}Nuova Nave{{end}}</h1>
</div>

<div class="form-container">
    <form method="POST" class="form">
        <div class="form-row">
            <div class="form-group">
                <label for="compagnia_id">Compagnia *</label>
                <select id="compagnia_id" name="compagnia_id" required>
                    <option value="">-- Seleziona Compagnia --</option>
                    {{range .Data.Compagnie}}
                    <option value="{{.ID}}" {{if eq .ID $.Data.Nave.CompagniaID}}selected{{end}}>{{.Nome}}</option>
                    {{end}}
                </select>
            </div>
            <div class="form-group">
                <label for="nome">Nome Nave *</label>
                <input type="text" id="nome" name="nome" value="{{.Data.Nave.Nome}}" required>
            </div>
        </div>

        <div class="form-group">
            <label for="imo">Numero IMO</label>
            <input type="text" id="imo" name="imo" value="{{.Data.Nave.IMO}}" placeholder="es. 9876543">
        </div>

        <h3 class="mt-3 mb-2">Contatti Nave</h3>

        <div class="form-group">
            <label for="email_master">Email Comandante (Master)</label>
            <input type="email" id="email_master" name="email_master" value="{{.Data.Nave.EmailMaster}}">
        </div>

        <div class="form-group">
            <label for="email_direttore_macchina">Email Direttore di Macchina</label>
            <input type="email" id="email_direttore_macchina" name="email_direttore_macchina" value="{{.Data.Nave.EmailDirettoreMacchina}}">
        </div>

        <div class="form-group">
            <label for="email_ispettore">Email Ispettore Nave</label>
            <input type="email" id="email_ispettore" name="email_ispettore" value="{{.Data.Nave.EmailIspettore}}">
        </div>

        <div class="form-section stato-lavori">
            <h3>Stato Nave</h3>
            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="ferma_per_lavori" name="ferma_per_lavori" 
                           {{if .Data.Nave.FermaPerLavori}}checked{{end}}
                           onchange="toggleDateLavori()">
                    <span class="checkbox-text">Ferma per lavori</span>
                </label>
                <small class="form-help">Spunta se la nave e' in cantiere/manutenzione e gli apparati non sono raggiungibili da remoto</small>
            </div>

            <div id="date-lavori" class="date-lavori-section" style="{{if not .Data.Nave.FermaPerLavori}}display:none{{end}}">
                <div class="form-row">
                    <div class="form-group">
                        <label for="data_inizio_lavori">Data Inizio Lavori</label>
                        <input type="date" id="data_inizio_lavori" name="data_inizio_lavori" 
                               value="{{if .Data.Nave.DataInizioLavori}}{{.Data.Nave.DataInizioLavori.Format "2006-01-02"}}{{end}}">
                    </div>
                    <div class="form-group">
                        <label for="data_fine_lavori_prevista">Data Fine Prevista</label>
                        <input type="date" id="data_fine_lavori_prevista" name="data_fine_lavori_prevista"
                               value="{{if .Data.Nave.DataFineLavoriPrev}}{{.Data.Nave.DataFineLavoriPrev.Format "2006-01-02"}}{{end}}">
                    </div>
                </div>
                <div class="form-group">
                    <label for="porto_lavori_id">Porto dove si effettuano i lavori</label>
                    <select id="porto_lavori_id" name="porto_lavori_id">
                        <option value="">-- Nessun porto specificato --</option>
                        {{range .Data.Porti}}
                        <option value="{{.ID}}" {{if eq .ID $.Data.Nave.PortoLavoriID}}selected{{end}}>{{.Nome}}</option>
                        {{end}}
                    </select>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="note">Note</label>
            <textarea id="note" name="note">{{.Data.Nave.Note}}</textarea>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">{{if .Data.Nave.ID}}Salva Modifiche{{else}}Crea Nave{{end}}</button>
            <a href="/anagrafiche/navi" class="btn btn-secondary">Annulla</a>
        </div>
    </form>
</div>

<script>
function toggleDateLavori() {
    var checkbox = document.getElementById('ferma_per_lavori');
    var dateSection = document.getElementById('date-lavori');
    if (checkbox.checked) {
        dateSection.style.display = 'block';
    } else {
        dateSection.style.display = 'none';
        document.getElementById('data_inizio_lavori').value = '';
        document.getElementById('data_fine_lavori_prevista').value = '';
        document.getElementById('porto_lavori_id').value = '';
    }
}
</script>

<style>
.stato-lavori {
    background: #fff3cd;
    border: 1px solid #ffc107;
    border-radius: 8px;
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
}
.stato-lavori h3 {
    margin-top: 0;
    color: #856404;
}
.checkbox-group {
    margin-bottom: 0.5rem;
}
.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-weight: 500;
}
.checkbox-label input[type="checkbox"] {
    width: 1.2rem;
    height: 1.2rem;
}
.date-lavori-section {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px dashed #ffc107;
}
</style>
{{end}}
