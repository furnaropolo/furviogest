{{template "base" .}}

{{define "content"}}
<div class="page-header">
    <h1>Foglio Mensile - {{.Data.NomeMese}} {{.Data.AnnoFilter}}</h1>
</div>

<div class="filter-form">
    <form method="GET" class="form-inline">
        {{if .Session.IsTecnico}}
        <div class="form-group">
            <label for="tecnico">Tecnico</label>
            <select name="tecnico" id="tecnico">
                <option value="">Tutti</option>
                {{range .Data.Tecnici}}
                <option value="{{.ID}}" {{if eq (printf "%d" .ID) $.Data.TecnicoFilter}}selected{{end}}>
                    {{.Cognome}} {{.Nome}}
                </option>
                {{end}}
            </select>
        </div>
        {{end}}
        <div class="form-group">
            <label for="mese">Mese</label>
            <select name="mese" id="mese">
                <option value="01" {{if eq .Data.MeseFilter "01"}}selected{{end}}>Gennaio</option>
                <option value="02" {{if eq .Data.MeseFilter "02"}}selected{{end}}>Febbraio</option>
                <option value="03" {{if eq .Data.MeseFilter "03"}}selected{{end}}>Marzo</option>
                <option value="04" {{if eq .Data.MeseFilter "04"}}selected{{end}}>Aprile</option>
                <option value="05" {{if eq .Data.MeseFilter "05"}}selected{{end}}>Maggio</option>
                <option value="06" {{if eq .Data.MeseFilter "06"}}selected{{end}}>Giugno</option>
                <option value="07" {{if eq .Data.MeseFilter "07"}}selected{{end}}>Luglio</option>
                <option value="08" {{if eq .Data.MeseFilter "08"}}selected{{end}}>Agosto</option>
                <option value="09" {{if eq .Data.MeseFilter "09"}}selected{{end}}>Settembre</option>
                <option value="10" {{if eq .Data.MeseFilter "10"}}selected{{end}}>Ottobre</option>
                <option value="11" {{if eq .Data.MeseFilter "11"}}selected{{end}}>Novembre</option>
                <option value="12" {{if eq .Data.MeseFilter "12"}}selected{{end}}>Dicembre</option>
            </select>
        </div>
        <div class="form-group">
            <label for="anno">Anno</label>
            <select name="anno" id="anno">
                <option value="2024" {{if eq .Data.AnnoFilter "2024"}}selected{{end}}>2024</option>
                <option value="2025" {{if eq .Data.AnnoFilter "2025"}}selected{{end}}>2025</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Visualizza</button>
    </form>
</div>

<!-- Riepilogo per Tecnico -->
<div class="section-header mt-3">
    <h2>Riepilogo per Tecnico</h2>
</div>

<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>Tecnico</th>
                <th>Trasferte</th>
                <th>Km Tot.</th>
                <th>Rapporti</th>
                <th>Tot. Spese</th>
                <th>Vitto</th>
                <th>Alloggio</th>
                <th>Carburante</th>
                <th>Pedaggi</th>
                <th>Altro</th>
            </tr>
        </thead>
        <tbody>
            {{range .Data.Riepiloghi}}
            <tr>
                <td><strong>{{.NomeTecnico}}</strong></td>
                <td>{{.NumTrasferte}}</td>
                <td>{{printf "%.0f" .TotaleKm}} km</td>
                <td>{{.NumRapporti}}</td>
                <td class="text-right"><strong>{{printf "%.2f" .TotaleSpese}} &euro;</strong></td>
                <td class="text-right">{{printf "%.2f" .TotaleVitto}} &euro;</td>
                <td class="text-right">{{printf "%.2f" .TotaleAlloggio}} &euro;</td>
                <td class="text-right">{{printf "%.2f" .TotaleCarbur}} &euro;</td>
                <td class="text-right">{{printf "%.2f" .TotalePedaggi}} &euro;</td>
                <td class="text-right">{{printf "%.2f" .TotaleAltro}} &euro;</td>
            </tr>
            {{else}}
            <tr>
                <td colspan="10" class="text-center">Nessun dato per il periodo selezionato</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<!-- Dettaglio Trasferte -->
<div class="section-header mt-3">
    <h2>Dettaglio Trasferte</h2>
</div>

<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>Data Part.</th>
                <th>Data Rient.</th>
                {{if .Session.IsTecnico}}<th>Tecnico</th>{{end}}
                <th>Destinazione</th>
                <th>Automezzo</th>
                <th>Km</th>
            </tr>
        </thead>
        <tbody>
            {{range .Data.DettaglioTrasferte}}
            <tr>
                <td>{{.DataPartenza}}</td>
                <td>{{.DataRientro}}</td>
                {{if $.Session.IsTecnico}}<td>{{.Tecnico}}</td>{{end}}
                <td>{{.Destinazione}}</td>
                <td>{{.Automezzo}}</td>
                <td>{{printf "%.0f" .Km}} km</td>
            </tr>
            {{else}}
            <tr>
                <td colspan="6" class="text-center">Nessuna trasferta nel periodo</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<!-- Dettaglio Spese -->
<div class="section-header mt-3">
    <h2>Dettaglio Spese</h2>
</div>

<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>Data</th>
                {{if .Session.IsTecnico}}<th>Tecnico</th>{{end}}
                <th>Tipo</th>
                <th>Descrizione</th>
                <th>Importo</th>
                <th>Pagamento</th>
            </tr>
        </thead>
        <tbody>
            {{range .Data.DettaglioSpese}}
            <tr>
                <td>{{.Data}}</td>
                {{if $.Session.IsTecnico}}<td>{{.Tecnico}}</td>{{end}}
                <td><span class="badge">{{.Tipo}}</span></td>
                <td>{{.Descrizione}}</td>
                <td class="text-right">{{printf "%.2f" .Importo}} &euro;</td>
                <td>{{.MetodoPagamento}}</td>
            </tr>
            {{else}}
            <tr>
                <td colspan="6" class="text-center">Nessuna spesa nel periodo</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<!-- Dettaglio Rapporti -->
<div class="section-header mt-3">
    <h2>Dettaglio Rapporti Intervento</h2>
</div>

<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Tipo</th>
                <th>Nave</th>
                <th>Tecnici</th>
                <th>Azioni</th>
            </tr>
        </thead>
        <tbody>
            {{range .Data.DettaglioRapporti}}
            <tr>
                <td>{{.Data}}</td>
                <td>{{.Tipo}}</td>
                <td>{{.Nave}}</td>
                <td>{{.Tecnici}}</td>
                <td>
                    <a href="/rapporti/dettaglio/{{.ID}}" class="btn btn-small">Vedi</a>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="5" class="text-center">Nessun rapporto nel periodo</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>
{{end}}
